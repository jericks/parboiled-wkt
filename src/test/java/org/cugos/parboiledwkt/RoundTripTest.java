package org.cugos.parboiledwkt;

import org.junit.Test;

import static org.junit.Assert.assertEquals;

public class RoundTripTest {

    @Test
    public void roundTrip() {

        // WKT
        WKTReader wktReader = new WKTReader();
        WKTWriter wktWriter = new WKTWriter();

        // WKB
        WKBReader wkbReader = new WKBReader();
        WKBWriter wkbWriter = new WKBWriter(WKB.Type.EWKB, WKB.Endian.Big);

        String[] wkts = {
            // POINT
            "POINT (1.0 2.0)",
            "POINT M (1.0 2.0 3.4)",
            "POINT Z (1.0 2.0 3.4)",
            "POINT ZM (1.0 2.0 3.4 6.7)",
            // LINESTRING
            "LINESTRING (1.0 1.0, 10.0 10.0)",
            "LINESTRING M (1.0 1.0 2.2, 10.0 10.0 3.3)",
            "LINESTRING Z (1.0 1.0 2.2, 10.0 10.0 3.3)",
            "LINESTRING ZM (1.0 1.0 2.2 1.2, 10.0 10.0 3.3 5.6)",
            // POLYGON
            "POLYGON ((35.0 10.0, 45.0 45.0, 15.0 40.0, 10.0 20.0, 35.0 10.0), (20.0 30.0, 35.0 35.0, 30.0 20.0, 20.0 30.0))",
            "POLYGON M ((35.0 10.0 1.1, 45.0 45.0 2.2, 15.0 40.0 3.3, 10.0 20.0 4.4, 35.0 10.0 5.5), (20.0 30.0 6.6, 35.0 35.0 7.7, 30.0 20.0 8.8, 20.0 30.0 1.1))",
            "POLYGON Z ((35.0 10.0 1.1, 45.0 45.0 2.2, 15.0 40.0 3.3, 10.0 20.0 4.4, 35.0 10.0 5.5), (20.0 30.0 6.6, 35.0 35.0 7.7, 30.0 20.0 8.8, 20.0 30.0 1.1))",
            "POLYGON ZM ((35.0 10.0 1.1 1.2, 45.0 45.0 2.2 2.3, 15.0 40.0 3.3 3.4, 10.0 20.0 4.4 4.5, 35.0 10.0 5.5 5.6), (20.0 30.0 6.6 6.7, 35.0 35.0 7.7 7.8, 30.0 20.0 8.8 8.9, 20.0 30.0 1.1 1.2))",
            // MULTIPOINT
            "MULTIPOINT (1.1 2.2, 3.3 4.4)",
            "MULTIPOINT M (1.1 2.2 5.6, 3.3 4.4 6.7)",
            "MULTIPOINT Z (1.1 2.2 5.6, 3.3 4.4 6.7)",
            "MULTIPOINT ZM (1.1 2.2 5.6 10.1, 3.3 4.4 6.7 13.4)",
            // CIRCULARSTRING
            "CIRCULARSTRING (101.0 234.0, 345.0 567.0)",
            "CIRCULARSTRING M (101.0 234.0 1.23, 345.0 567.0 3.45)",
            "CIRCULARSTRING Z (101.0 234.0 1.23, 345.0 567.0 3.45)",
            "CIRCULARSTRING ZM (101.0 234.0 1.23 5.67, 345.0 567.0 3.45 9.01)",
            // COMPOUNDCURVE
            "COMPOUNDCURVE (CIRCULARSTRING (1.0 0.0, 0.0 1.0, -1.0 0.0), (-1.0 0.0, 2.0 0.0))",
            "COMPOUNDCURVE M (CIRCULARSTRING (1.0 0.0 2.3, 0.0 1.0 4.5, -1.0 0.0 6.7), (-1.0 0.0 9.11, 2.0 0.0 10.45))",
            "COMPOUNDCURVE Z (CIRCULARSTRING (1.0 0.0 2.3, 0.0 1.0 4.5, -1.0 0.0 6.7), (-1.0 0.0 9.11, 2.0 0.0 10.45))",
            "COMPOUNDCURVE ZM (CIRCULARSTRING (1.0 0.0 2.3 4.5, 0.0 1.0 4.5 1.2, -1.0 0.0 6.7 4.7), (-1.0 0.0 9.11 11.2, 2.0 0.0 10.45 45.6))",
            // CURVEPOLYGON
            "CURVEPOLYGON (CIRCULARSTRING (0.0 0.0, 4.0 0.0, 4.0 4.0, 0.0 4.0, 0.0 0.0), (1.0 1.0, 3.0 3.0, 3.0 1.0, 1.0 1.0))",
            "CURVEPOLYGON M (CIRCULARSTRING (0.0 0.0 1.2, 4.0 0.0 2.3, 4.0 4.0 3.4, 0.0 4.0 4.5, 0.0 0.0 5.6), (1.0 1.0 9.8, 3.0 3.0 8.7, 3.0 1.0 7.6, 1.0 1.0 6.5))",
            "CURVEPOLYGON Z (CIRCULARSTRING (0.0 0.0 1.2, 4.0 0.0 2.3, 4.0 4.0 3.4, 0.0 4.0 4.5, 0.0 0.0 5.6), (1.0 1.0 9.8, 3.0 3.0 8.7, 3.0 1.0 7.6, 1.0 1.0 6.5))",
            "CURVEPOLYGON ZM (CIRCULARSTRING (0.0 0.0 1.2 2.5, 4.0 0.0 2.3 2.5, 4.0 4.0 3.4 2.5, 0.0 4.0 4.5 2.5, 0.0 0.0 5.6 2.5), (1.0 1.0 9.8 2.5, 3.0 3.0 8.7 2.5, 3.0 1.0 7.6 2.5, 1.0 1.0 6.5 2.5))",
            // GEOMETRYCOLLECTION
            "GEOMETRYCOLLECTION (POINT (4.0 6.0), LINESTRING (4.0 6.0, 7.0 10.0))",
            "GEOMETRYCOLLECTION M (POINT (4.0 6.0 1.2), LINESTRING (4.0 6.0 5.6, 7.0 10.0 12.45))",
            "GEOMETRYCOLLECTION Z (POINT (4.0 6.0 1.2), LINESTRING (4.0 6.0 5.6, 7.0 10.0 12.45))",
            "GEOMETRYCOLLECTION ZM (POINT (4.0 6.0 1.2 98.1), LINESTRING (4.0 6.0 5.6 45.678, 7.0 10.0 12.45 1.456))",
            "GEOMETRYCOLLECTION (" +
                "POINT (4.0 6.0), " +
                "LINESTRING (4.0 6.0, 7.0 10.0), " +
                "POLYGON ((35.0 10.0, 45.0 45.0, 15.0 40.0, 10.0 20.0, 35.0 10.0), (20.0 30.0, 35.0 35.0, 30.0 20.0, 20.0 30.0)), " +
                "MULTIPOINT (1.1 2.2, 3.3 4.4), " +
                "CIRCULARSTRING (101.0 234.0, 345.0 567.0), " +
                "COMPOUNDCURVE (CIRCULARSTRING (1.0 0.0, 0.0 1.0, -1.0 0.0), (-1.0 0.0, 2.0 0.0)), " +
                "CURVEPOLYGON (CIRCULARSTRING (0.0 0.0, 4.0 0.0, 4.0 4.0, 0.0 4.0, 0.0 0.0), (1.0 1.0, 3.0 3.0, 3.0 1.0, 1.0 1.0)), " +
                "GEOMETRYCOLLECTION (POINT (4.0 6.0), LINESTRING (4.0 6.0, 7.0 10.0)), " +
                "MULTICURVE ((1.0 1.0, 10.0 10.0), (20.0 20.0, 30.0 40.0)), " +
                "MULTILINESTRING ((0.0 0.0, 1.0 1.0, 1.0 2.0), (2.0 3.0, 3.0 2.0, 5.0 4.0)), " +
                "MULTIPOLYGON (((40.0 40.0, 20.0 45.0, 45.0 30.0, 40.0 40.0), (20.0 35.0, 10.0 30.0, 10.0 10.0, 30.0 5.0, 45.0 20.0, 20.0 35.0), (30.0 20.0, 20.0 15.0, 20.0 25.0, 30.0 20.0))), " +
                "MULTISURFACE (CURVEPOLYGON (CIRCULARSTRING (0.0 0.0, 4.0 0.0, 4.0 4.0, 0.0 4.0, 0.0 0.0), (1.0 1.0, 3.0 3.0, 3.0 1.0, 1.0 1.0)), ((10.0 10.0, 14.0 12.0, 11.0 10.0, 10.0 10.0), (11.0 11.0, 11.5 11.0, 11.0 11.5, 11.0 11.0))), " +
                "POLYHEDRALSURFACE (((40.0 40.0, 20.0 45.0, 45.0 30.0, 40.0 40.0)), ((20.0 35.0, 10.0 30.0, 10.0 10.0, 30.0 5.0, 45.0 20.0, 20.0 35.0), (30.0 20.0, 20.0 15.0, 20.0 25.0, 30.0 20.0))), " +
                "TIN (((0.0 0.0, 1.0 0.0, 0.0 1.0, 0.0 0.0)), ((0.0 0.0, 0.0 1.0, 1.0 1.0, 0.0 0.0))), " +
                "TRIANGLE ((0.0 0.0, 0.0 1.0, 1.0 1.0, 0.0 0.0))" +
            ")",
            // MULTICURVE
            "MULTICURVE ((1.0 1.0, 10.0 10.0), (20.0 20.0, 30.0 40.0))",
            "MULTICURVE M ((1.0 1.0 56.4, 10.0 10.0 -12.5), (20.0 20.0 56.7, 30.0 40.0 99.1))",
            "MULTICURVE Z ((1.0 1.0 56.4, 10.0 10.0 -12.5), (20.0 20.0 56.7, 30.0 40.0 99.1))",
            "MULTICURVE ZM ((1.0 1.0 56.4 -12.1, 10.0 10.0 -12.5 45.3), (20.0 20.0 56.7 1.01, 30.0 40.0 99.12 2.5))",
            // MULTILINESTRING
            "MULTILINESTRING ((0.0 0.0, 1.0 1.0, 1.0 2.0), (2.0 3.0, 3.0 2.0, 5.0 4.0))",
            "MULTILINESTRING M ((0.0 0.0 1.2, 1.0 1.0 2.3, 1.0 2.0 3.4), (2.0 3.0 4.4, 3.0 2.0 5.5, 5.0 4.0 6.7))",
            "MULTILINESTRING Z ((0.0 0.0 1.2, 1.0 1.0 2.3, 1.0 2.0 3.4), (2.0 3.0 4.4, 3.0 2.0 5.5, 5.0 4.0 6.7))",
            "MULTILINESTRING ZM ((0.0 0.0 1.2 4.5, 1.0 1.0 2.3 5.6, 1.0 2.0 3.4 7.8), (2.0 3.0 4.4 1.23, 3.0 2.0 5.5 45.6, 5.0 4.0 6.7 5.43))",
            // MULTIPOLYGON
            "MULTIPOLYGON (((40.0 40.0, 20.0 45.0, 45.0 30.0, 40.0 40.0), (20.0 35.0, 10.0 30.0, 10.0 10.0, 30.0 5.0, 45.0 20.0, 20.0 35.0), (30.0 20.0, 20.0 15.0, 20.0 25.0, 30.0 20.0)))",
            "MULTIPOLYGON M (((40.0 40.0 1.1, 20.0 45.0 2.2, 45.0 30.0 3.3, 40.0 40.0 4.4), (20.0 35.0 5.5, 10.0 30.0 6.6, 10.0 10.0 7.7, 30.0 5.0 8.8, 45.0 20.0 9.9, 20.0 35.0 1.2), (30.0 20.0 2.3, 20.0 15.0 3.4, 20.0 25.0 4.5, 30.0 20.0 5.6)))",
            "MULTIPOLYGON Z (((40.0 40.0 1.1, 20.0 45.0 2.2, 45.0 30.0 3.3, 40.0 40.0 4.4), (20.0 35.0 5.5, 10.0 30.0 6.6, 10.0 10.0 7.7, 30.0 5.0 8.8, 45.0 20.0 9.9, 20.0 35.0 1.2), (30.0 20.0 2.3, 20.0 15.0 3.4, 20.0 25.0 4.5, 30.0 20.0 5.6)))",
            "MULTIPOLYGON ZM (((40.0 40.0 1.1 2.1, 20.0 45.0 2.2 3.2, 45.0 30.0 3.3 4.3, 40.0 40.0 4.4 5.4), (20.0 35.0 5.5 6.7, 10.0 30.0 6.6 6.7, 10.0 10.0 7.7 6.7, 30.0 5.0 8.8 6.7, 45.0 20.0 9.9 6.7, 20.0 35.0 1.2 6.7), (30.0 20.0 2.3 6.7, 20.0 15.0 3.4 6.7, 20.0 25.0 4.5 6.7, 30.0 20.0 5.6 6.7)))",
            // MULTISURFACE
            "MULTISURFACE (CURVEPOLYGON (CIRCULARSTRING (0.0 0.0, 4.0 0.0, 4.0 4.0, 0.0 4.0, 0.0 0.0), (1.0 1.0, 3.0 3.0, 3.0 1.0, 1.0 1.0)), ((10.0 10.0, 14.0 12.0, 11.0 10.0, 10.0 10.0), (11.0 11.0, 11.5 11.0, 11.0 11.5, 11.0 11.0)))",
            "MULTISURFACE M (CURVEPOLYGON (CIRCULARSTRING (0.0 0.0 1.1, 4.0 0.0 2.2, 4.0 4.0 3.3, 0.0 4.0 4.4, 0.0 0.0 5.5), (1.0 1.0 2.3, 3.0 3.0 4.5, 3.0 1.0 5.5, 1.0 1.0 6.6)), ((10.0 10.0 7.7, 14.0 12.0 8.67, 11.0 10.0 1.23, 10.0 10.0 4.12), (11.0 11.0 56.2, 11.5 11.0 16.23, 11.0 11.5 291.1, 11.0 11.0 19.2)))",
            "MULTISURFACE Z (CURVEPOLYGON (CIRCULARSTRING (0.0 0.0 1.1, 4.0 0.0 2.2, 4.0 4.0 3.3, 0.0 4.0 4.4, 0.0 0.0 5.5), (1.0 1.0 2.3, 3.0 3.0 4.5, 3.0 1.0 5.5, 1.0 1.0 6.6)), ((10.0 10.0 7.7, 14.0 12.0 8.67, 11.0 10.0 1.23, 10.0 10.0 4.12), (11.0 11.0 56.2, 11.5 11.0 16.23, 11.0 11.5 291.1, 11.0 11.0 19.2)))",
            "MULTISURFACE ZM (CURVEPOLYGON (CIRCULARSTRING (0.0 0.0 1.1 2.67, 4.0 0.0 2.2 2.67, 4.0 4.0 3.3 2.67, 0.0 4.0 4.4 2.67, 0.0 0.0 5.5 2.67), (1.0 1.0 2.3 2.67, 3.0 3.0 4.5 2.67, 3.0 1.0 5.5 2.67, 1.0 1.0 6.6 2.67)), ((10.0 10.0 7.7 2.67, 14.0 12.0 8.67 2.67, 11.0 10.0 1.23 2.67, 10.0 10.0 4.12 2.67), (11.0 11.0 56.2 2.67, 11.5 11.0 16.23 2.67, 11.0 11.5 291.1 2.67, 11.0 11.0 19.2 2.67)))",
            // POLYHEDRALSURFACE
            "POLYHEDRALSURFACE (((40.0 40.0, 20.0 45.0, 45.0 30.0, 40.0 40.0)), ((20.0 35.0, 10.0 30.0, 10.0 10.0, 30.0 5.0, 45.0 20.0, 20.0 35.0), (30.0 20.0, 20.0 15.0, 20.0 25.0, 30.0 20.0)))",
            "POLYHEDRALSURFACE M (((40.0 40.0 1.23, 20.0 45.0 3.45, 45.0 30.0 5.67, 40.0 40.0 7.89)), ((20.0 35.0 1.1, 10.0 30.0 2.3, 10.0 10.0 4.5, 30.0 5.0 4.2, 45.0 20.0 1.1, 20.0 35.0 2.13), (30.0 20.0 1.1, 20.0 15.0 1.1, 20.0 25.0 1.1, 30.0 20.0 1.1)))",
            "POLYHEDRALSURFACE Z (((40.0 40.0 1.23, 20.0 45.0 3.45, 45.0 30.0 5.67, 40.0 40.0 7.89)), ((20.0 35.0 1.1, 10.0 30.0 2.3, 10.0 10.0 4.5, 30.0 5.0 4.2, 45.0 20.0 1.1, 20.0 35.0 2.13), (30.0 20.0 1.1, 20.0 15.0 1.1, 20.0 25.0 1.1, 30.0 20.0 1.1)))",
            "POLYHEDRALSURFACE ZM (((40.0 40.0 1.23 54.1, 20.0 45.0 3.45 54.1, 45.0 30.0 5.67 54.1, 40.0 40.0 7.89 54.1)), ((20.0 35.0 1.1 54.1, 10.0 30.0 2.3 54.1, 10.0 10.0 4.5 54.1, 30.0 5.0 4.2 54.1, 45.0 20.0 1.1 54.1, 20.0 35.0 2.13 54.1), (30.0 20.0 1.1 54.1, 20.0 15.0 1.1 54.1, 20.0 25.0 1.1 54.1, 30.0 20.0 1.1 54.1)))",
            // TIN
            "TIN (((0.0 0.0, 1.0 0.0, 0.0 1.0, 0.0 0.0)), ((0.0 0.0, 0.0 1.0, 1.0 1.0, 0.0 0.0)))",
            "TIN M (((0.0 0.0 1.2, 1.0 0.0 3.4, 0.0 1.0 4.5, 0.0 0.0 5.6)), ((0.0 0.0 9.8, 0.0 1.0 8.7, 1.0 1.0 7.6, 0.0 0.0 6.5)))",
            "TIN Z (((0.0 0.0 1.2, 1.0 0.0 3.4, 0.0 1.0 4.5, 0.0 0.0 5.6)), ((0.0 0.0 9.8, 0.0 1.0 8.7, 1.0 1.0 7.6, 0.0 0.0 6.5)))",
            "TIN ZM (((0.0 0.0 1.2 4.3, 1.0 0.0 3.4 5.6, 0.0 1.0 4.5 1.2, 0.0 0.0 5.6 6.5)), ((0.0 0.0 9.8 4.3, 0.0 1.0 8.7 1.2, 1.0 1.0 7.6 5.1, 0.0 0.0 6.5 98.1)))",
            // TRIANGLE
            "TRIANGLE ((0.0 0.0, 0.0 1.0, 1.0 1.0, 0.0 0.0))",
            "TRIANGLE M ((0.0 0.0 1.2, 0.0 1.0 3.4, 1.0 1.0 9.87, 0.0 0.0 1.23))",
            "TRIANGLE Z ((0.0 0.0 1.2, 0.0 1.0 3.4, 1.0 1.0 9.87, 0.0 0.0 1.23))",
            "TRIANGLE ZM ((0.0 0.0 1.2 5.6, 0.0 1.0 3.4 9.4, 1.0 1.0 9.87 1.123, 0.0 0.0 1.23 6.1))"
        };

        String[] srids = {
            "",
            "SRID=4326;"
        };

        for(String wkt : wkts) {
            for(String srid : srids) {
                // Read from WKT
                Geometry geometry = wktReader.read(srid + wkt);
                // Write to WKT
                assertEquals("Should be " + srid + wkt, srid + wkt, wktWriter.write(geometry));
                // Write to WKB
                byte[] bytes = wkbWriter.write(geometry);
                // Read from WKB
                Geometry geometryFromWkb = wkbReader.read(bytes);
                assertEquals("Should be " + srid + wkt, srid + wkt, geometryFromWkb.toString());
            }
        }

    }

}
